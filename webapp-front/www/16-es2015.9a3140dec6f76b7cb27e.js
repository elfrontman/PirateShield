(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"5zjZ":function(l,n,e){"use strict";e.r(n);var t=e("8Y7J"),u=e("0iYF");class s{constructor(l,n,e){this.file=l,this.MAX_IMAGE_SIZE_PROCESS=n,this.type=this.file.type,this.name=e+"_"+this.file.name,this.reader=new FileReader}getImage(){var l=this;return new Promise(function(n,e){l.reader.onloadend=l.loadEndReader.bind(l,n,e),l.reader.readAsDataURL(l.file)})}base64ToArrayBuffer(l){l=l.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(l),e=n.length,t=new Uint8Array(e),u=0;u<e;u++)t[u]=n.charCodeAt(u);return t.buffer}loadEndReader(l,n){var e=new Image,t=this;e.onload=function(){var n=t.MAX_IMAGE_SIZE_PROCESS,u=t.MAX_IMAGE_SIZE_PROCESS,s=e.width,o=e.height;s>o?s>n&&(o*=n/s,s=n):o>u&&(s*=u/o,o=u);var i=document.createElement("canvas");i.width=s,i.height=o,i.getContext("2d").drawImage(this,0,0,i.width,i.height);var r=i.toDataURL(t.type),a=t.dataURLtoBlob(r);l(a)},e.onerror=function(l){n(l)},e.src=this.reader.result}dataURLtoBlob(l){for(var n=atob(l.split(",")[1]),e=[],t=n.length,u=0;u<t;u++)e.push(n.charCodeAt(u));var s=new Blob([new Uint8Array(e)],{type:this.type});return new File([s],this.name,{type:this.type,lastModified:s.lastModifiedDate})}}class o{constructor(l,n){this.socket=l,this.service=n,this.message="",this.messages=[],this.tokenUser=""}ngAfterViewChecked(){}ngOnInit(){this.username=localStorage.getItem("user_name"),this.socket.connect(),this.socket.fromEvent("chat-token").subscribe(l=>{this.tokenUser=this.service.getUserId(),this.tokenOP=localStorage.getItem("token"),this.socket.emit("create",this.tokenUser),this.service.getChat(this.tokenUser).subscribe(l=>{console.log(l),this.messages=l,this.scrollBottom()})}),this.socket.fromEvent("received").subscribe(l=>{this.messages.push(l),this.scrollBottom()})}sendMessage(){const l={message:this.message,sender:Number(this.service.getUserId()),receiver:1,type:"text",user_sender:this.username,user_receiver:"Admin",chat_id:this.tokenUser,operativo:this.tokenOP,createdAt:new Date};console.log(l),this.socket.emit("send-message",l),this.messages.push(l),this.message="",this.scrollBottom()}sendImageMessage(l){new s(l.files[0],1024,null).getImage().then(l=>{var n=new FileReader;n.onloadend=l=>{const e={message:n.result,sender:Number(this.service.getUserId()),receiver:1,type:"image",user_sender:this.username,user_receiver:"Admin",chat_id:this.tokenUser,operativo:this.tokenOP,createdAt:new Date};this.socket.emit("send-message",e),this.messages.push(e),this.scrollBottom()},n.readAsDataURL(l)})}ionViewWillLeave(){this.socket.disconnect()}scrollBottom(){try{setTimeout(l=>{this.chatview.el.scrollToBottom(0)})}catch(l){console.log(l)}}}class i{}var r=e("pMnS"),a=e("oBZk"),c=e("ZZ/e"),b=e("SVse"),h=e("iInd"),g=e("s7LF"),m=e("RH9n"),d=t.pb({encapsulation:0,styles:[[".message[_ngcontent-%COMP%]{padding:10px;border-radius:10px;margin-bottom:4px;white-space:pre-wrap}.my-message[_ngcontent-%COMP%]{background:#3880ff;color:#fff}.other-message[_ngcontent-%COMP%]{background:#e3e3e3;color:#333}.time[_ngcontent-%COMP%]{color:#dfdfdf;float:right;font-size:small}.username[_ngcontent-%COMP%]{display:block;text-align:left!important;font-weight:700;font-style:italic;color:#fff;font-size:.9rem;margin-bottom:.5rem}.other-message[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%], .other-message[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{color:#333}.message-input[_ngcontent-%COMP%]{margin-top:0;background:#fff;min-height:40px}.msg-btn[_ngcontent-%COMP%]{--padding-start:0.5em;--padding-end:0.5em}.icon-svg[_ngcontent-%COMP%]{width:30px;height:30px}"]],data:{}});function p(l){return t.Nb(0,[(l()(),t.rb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),t.Lb(1,null,["",""]))],null,function(l,n){l(n,1,0,n.parent.context.$implicit.message)})}function k(l){return t.Nb(0,[(l()(),t.rb(0,0,null,null,0,"img",[],[[8,"src",4]],null,null,null,null))],null,function(l,n){l(n,0,0,n.parent.context.$implicit.message)})}function f(l){return t.Nb(0,[(l()(),t.rb(0,0,null,null,16,"ion-row",[],null,null,null,a.O,a.o)),t.qb(1,49152,null,0,c.hb,[t.h,t.k,t.x],null,null),(l()(),t.rb(2,0,null,0,14,"ion-col",[["class","message"],["size","9"]],[[1,"offset",0]],null,null,a.E,a.e)),t.Ib(512,null,b.u,b.v,[t.q,t.r,t.k,t.B]),t.qb(4,278528,null,0,b.i,[b.u],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.qb(5,49152,null,0,c.s,[t.h,t.k,t.x],{size:[0,"size"]},null),(l()(),t.rb(6,0,null,0,1,"div",[["class","username"],["text-right",""]],null,null,null,null,null)),(l()(),t.Lb(7,null,["",""])),(l()(),t.rb(8,0,null,0,5,"div",[],null,null,null,null,null)),t.qb(9,16384,null,0,b.o,[],{ngSwitch:[0,"ngSwitch"]},null),(l()(),t.gb(16777216,null,null,1,null,p)),t.qb(11,278528,null,0,b.p,[t.M,t.J,b.o],{ngSwitchCase:[0,"ngSwitchCase"]},null),(l()(),t.gb(16777216,null,null,1,null,k)),t.qb(13,278528,null,0,b.p,[t.M,t.J,b.o],{ngSwitchCase:[0,"ngSwitchCase"]},null),(l()(),t.rb(14,0,null,0,2,"div",[["class","time"],["text-right",""]],null,null,null,null,null)),(l()(),t.Lb(15,null,["",""])),t.Hb(16,2)],function(l,n){l(n,4,0,"message",n.context.$implicit.sender!=n.component.tokenUser?"my-message":"other-message"),l(n,5,0,"9"),l(n,9,0,n.context.$implicit.type),l(n,11,0,"text"),l(n,13,0,"image")},function(l,n){l(n,2,0,n.context.$implicit.sender==n.component.tokenUser?"":3),l(n,7,0,n.context.$implicit.user_name);var e=t.Mb(n,15,0,l(n,16,0,t.Db(n.parent,0),n.context.$implicit.createdAt,"short"));l(n,15,0,e)})}function v(l){return t.Nb(0,[t.Fb(0,b.d,[t.s]),t.Jb(671088640,1,{chatview:0}),(l()(),t.rb(2,0,null,null,23,"ion-header",[],null,null,null,a.I,a.i)),t.qb(3,49152,null,0,c.A,[t.h,t.k,t.x],null,null),(l()(),t.rb(4,0,null,0,21,"ion-toolbar",[["color","primary"]],null,null,null,a.Z,a.z)),t.qb(5,49152,null,0,c.Ab,[t.h,t.k,t.x],{color:[0,"color"]},null),(l()(),t.rb(6,0,null,0,19,"ion-grid",[],null,null,null,a.H,a.h)),t.qb(7,49152,null,0,c.z,[t.h,t.k,t.x],null,null),(l()(),t.rb(8,0,null,0,17,"ion-row",[["align-items-center",""]],null,null,null,a.O,a.o)),t.qb(9,49152,null,0,c.hb,[t.h,t.k,t.x],null,null),(l()(),t.rb(10,0,null,0,8,"ion-col",[["size","2"]],null,null,null,a.E,a.e)),t.qb(11,49152,null,0,c.s,[t.h,t.k,t.x],{size:[0,"size"]},null),(l()(),t.rb(12,0,null,0,6,"ion-buttons",[["routerLink","/brands"]],null,[[null,"click"]],function(l,n,e){var u=!0;return"click"===n&&(u=!1!==t.Db(l,14).onClick()&&u),"click"===n&&(u=!1!==t.Db(l,15).onClick(e)&&u),u},a.C,a.c)),t.qb(13,49152,null,0,c.k,[t.h,t.k,t.x],null,null),t.qb(14,16384,null,0,h.n,[h.m,h.a,[8,null],t.B,t.k],{routerLink:[0,"routerLink"]},null),t.qb(15,737280,null,0,c.Ib,[b.h,c.Fb,t.k,h.m,[2,h.n]],null,null),(l()(),t.rb(16,0,null,0,2,"ion-button",[],null,null,null,a.B,a.b)),t.qb(17,49152,null,0,c.j,[t.h,t.k,t.x],null,null),(l()(),t.rb(18,0,null,0,0,"img",[["class","icon-svg"],["src","./assets/images/back.svg"]],null,null,null,null,null)),(l()(),t.rb(19,0,null,0,4,"ion-col",[["size","8"]],null,null,null,a.E,a.e)),t.qb(20,49152,null,0,c.s,[t.h,t.k,t.x],{size:[0,"size"]},null),(l()(),t.rb(21,0,null,0,2,"ion-title",[],null,null,null,a.Y,a.y)),t.qb(22,49152,null,0,c.yb,[t.h,t.k,t.x],null,null),(l()(),t.Lb(-1,0,["CHAT"])),(l()(),t.rb(24,0,null,0,1,"ion-col",[["size","2"]],null,null,null,a.E,a.e)),t.qb(25,49152,null,0,c.s,[t.h,t.k,t.x],{size:[0,"size"]},null),(l()(),t.rb(26,0,null,null,5,"ion-content",[],null,null,null,a.F,a.f)),t.qb(27,49152,[[1,4],["chatview",4]],0,c.t,[t.h,t.k,t.x],null,null),(l()(),t.rb(28,0,null,0,3,"ion-grid",[],null,null,null,a.H,a.h)),t.qb(29,49152,null,0,c.z,[t.h,t.k,t.x],null,null),(l()(),t.gb(16777216,null,0,1,null,f)),t.qb(31,278528,null,0,b.j,[t.M,t.J,t.q],{ngForOf:[0,"ngForOf"]},null),(l()(),t.rb(32,0,null,null,27,"ion-footer",[],null,null,null,a.G,a.g)),t.qb(33,49152,null,0,c.y,[t.h,t.k,t.x],null,null),(l()(),t.rb(34,0,null,0,25,"ion-toolbar",[["color","light"]],null,null,null,a.Z,a.z)),t.qb(35,49152,null,0,c.Ab,[t.h,t.k,t.x],{color:[0,"color"]},null),(l()(),t.rb(36,0,null,0,23,"ion-row",[["align-items-center",""]],null,null,null,a.O,a.o)),t.qb(37,49152,null,0,c.hb,[t.h,t.k,t.x],null,null),(l()(),t.rb(38,0,null,0,8,"ion-col",[["size","8"]],null,null,null,a.E,a.e)),t.qb(39,49152,null,0,c.s,[t.h,t.k,t.x],{size:[0,"size"]},null),(l()(),t.rb(40,0,null,0,6,"ion-textarea",[["auto-grow",""],["class","message-input"],["rows","1"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionBlur"],[null,"ionChange"]],function(l,n,e){var u=!0,s=l.component;return"ionBlur"===n&&(u=!1!==t.Db(l,41)._handleBlurEvent()&&u),"ionChange"===n&&(u=!1!==t.Db(l,41)._handleInputEvent(e.target.value)&&u),"ngModelChange"===n&&(u=!1!==(s.message=e)&&u),u},a.W,a.w)),t.qb(41,16384,null,0,c.Kb,[t.k],null,null),t.Ib(1024,null,g.b,function(l){return[l]},[c.Kb]),t.qb(43,671744,null,0,g.e,[[8,null],[8,null],[8,null],[6,g.b]],{model:[0,"model"]},{update:"ngModelChange"}),t.Ib(2048,null,g.c,null,[g.e]),t.qb(45,16384,null,0,g.d,[[4,g.c]],null,null),t.qb(46,49152,null,0,c.wb,[t.h,t.k,t.x],{rows:[0,"rows"]},null),(l()(),t.rb(47,0,null,0,6,"ion-col",[["size","2"]],null,null,null,a.E,a.e)),t.qb(48,49152,null,0,c.s,[t.h,t.k,t.x],{size:[0,"size"]},null),(l()(),t.rb(49,0,null,0,4,"ion-button",[["class","msg-btn"],["color","primary"],["expand","block"],["fill","clear"]],null,[[null,"click"]],function(l,n,e){var u=!0;return"click"===n&&(u=!1!==t.Db(l,53).click()&&u),u},a.B,a.b)),t.qb(50,49152,null,0,c.j,[t.h,t.k,t.x],{color:[0,"color"],expand:[1,"expand"],fill:[2,"fill"]},null),(l()(),t.rb(51,0,null,0,1,"ion-icon",[["name","ios-camera"],["slot","icon-only"]],null,null,null,a.J,a.j)),t.qb(52,49152,null,0,c.B,[t.h,t.k,t.x],{name:[0,"name"]},null),(l()(),t.rb(53,0,[["filechooser",1]],0,0,"input",[["capture","camera"],["hidden",""],["type","file"]],null,[[null,"change"]],function(l,n,e){var u=!0;return"change"===n&&(u=!1!==l.component.sendImageMessage(t.Db(l,53))&&u),u},null,null)),(l()(),t.rb(54,0,null,0,5,"ion-col",[["size","2"]],null,null,null,a.E,a.e)),t.qb(55,49152,null,0,c.s,[t.h,t.k,t.x],{size:[0,"size"]},null),(l()(),t.rb(56,0,null,0,3,"ion-button",[["class","msg-btn"],["color","primary"],["expand","block"],["fill","clear"]],null,[[null,"click"]],function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.sendMessage()&&t),t},a.B,a.b)),t.qb(57,49152,null,0,c.j,[t.h,t.k,t.x],{color:[0,"color"],disabled:[1,"disabled"],expand:[2,"expand"],fill:[3,"fill"]},null),(l()(),t.rb(58,0,null,0,1,"ion-icon",[["name","ios-send"],["slot","icon-only"]],null,null,null,a.J,a.j)),t.qb(59,49152,null,0,c.B,[t.h,t.k,t.x],{name:[0,"name"]},null)],function(l,n){var e=n.component;l(n,5,0,"primary"),l(n,11,0,"2"),l(n,14,0,"/brands"),l(n,15,0),l(n,20,0,"8"),l(n,25,0,"2"),l(n,31,0,e.messages),l(n,35,0,"light"),l(n,39,0,"8"),l(n,43,0,e.message),l(n,46,0,"1"),l(n,48,0,"2"),l(n,50,0,"primary","block","clear"),l(n,52,0,"ios-camera"),l(n,55,0,"2"),l(n,57,0,"primary",""===e.message,"block","clear"),l(n,59,0,"ios-send")},function(l,n){l(n,40,0,t.Db(n,45).ngClassUntouched,t.Db(n,45).ngClassTouched,t.Db(n,45).ngClassPristine,t.Db(n,45).ngClassDirty,t.Db(n,45).ngClassValid,t.Db(n,45).ngClassInvalid,t.Db(n,45).ngClassPending)})}function x(l){return t.Nb(0,[(l()(),t.rb(0,0,null,null,1,"app-chat",[],null,null,null,v,d)),t.qb(1,8503296,null,0,o,[m.a,u.a],null,null)],function(l,n){l(n,1,0)},null)}var w=t.nb("app-chat",o,x,{},{},[]);e.d(n,"ChatPageModuleNgFactory",function(){return C});var C=t.ob(i,[],function(l){return t.Ab([t.Bb(512,t.j,t.Z,[[8,[r.a,w]],[3,t.j],t.v]),t.Bb(4608,b.m,b.l,[t.s,[2,b.z]]),t.Bb(4608,g.g,g.g,[]),t.Bb(4608,c.b,c.b,[t.x,t.g]),t.Bb(4608,c.Eb,c.Eb,[c.b,t.j,t.p]),t.Bb(4608,c.Hb,c.Hb,[c.b,t.j,t.p]),t.Bb(5120,m.a,m.c,[m.d]),t.Bb(1073742336,b.b,b.b,[]),t.Bb(1073742336,g.f,g.f,[]),t.Bb(1073742336,g.a,g.a,[]),t.Bb(1073742336,c.Cb,c.Cb,[]),t.Bb(1073742336,h.o,h.o,[[2,h.t],[2,h.m]]),t.Bb(1073742336,m.b,m.b,[]),t.Bb(1073742336,i,i,[]),t.Bb(1024,h.k,function(){return[[{path:"",component:o}]]},[]),t.Bb(256,m.d,{url:"http://190.60.205.188:500",options:{}},[])])})}}]);