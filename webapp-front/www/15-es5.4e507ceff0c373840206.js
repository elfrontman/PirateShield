(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"5zjZ":function(l,n,e){"use strict";e.r(n);var t=e("CcnG"),u=e("0iYF"),o=function(){function l(l,n,e){this.file=l,this.MAX_IMAGE_SIZE_PROCESS=n,this.type=this.file.type,this.name=e+"_"+this.file.name,this.reader=new FileReader}return l.prototype.getImage=function(){var l=this;return new Promise(function(n,e){l.reader.onloadend=l.loadEndReader.bind(l,n,e),l.reader.readAsDataURL(l.file)})},l.prototype.base64ToArrayBuffer=function(l){l=l.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(l),e=n.length,t=new Uint8Array(e),u=0;u<e;u++)t[u]=n.charCodeAt(u);return t.buffer},l.prototype.loadEndReader=function(l,n){var e=new Image,t=this;e.onload=function(){var n=t.MAX_IMAGE_SIZE_PROCESS,u=t.MAX_IMAGE_SIZE_PROCESS,o=e.width,i=e.height;o>i?o>n&&(i*=n/o,o=n):i>u&&(o*=u/i,i=u);var s=document.createElement("canvas");s.width=o,s.height=i,s.getContext("2d").drawImage(this,0,0,s.width,s.height);var a=s.toDataURL(t.type),r=t.dataURLtoBlob(a);l(r)},e.onerror=function(l){n(l)},e.src=this.reader.result},l.prototype.dataURLtoBlob=function(l){for(var n=atob(l.split(",")[1]),e=[],t=n.length,u=0;u<t;u++)e.push(n.charCodeAt(u));var o=new Blob([new Uint8Array(e)],{type:this.type});return new File([o],this.name,{type:this.type,lastModified:o.lastModifiedDate})},l}(),i=function(){function l(l,n){this.socket=l,this.service=n,this.message="",this.messages=[],this.tokenUser="",this.modalImage=!1}return l.prototype.ngAfterViewChecked=function(){},l.prototype.showImage=function(l){this.imageSelected=l,this.modalImage=!0},l.prototype.ngOnInit=function(){var l=this;this.service.setUnReadMessages(0),this.username=localStorage.getItem("user_name"),this.socket.connect(),this.socket.fromEvent("chat-token").subscribe(function(n){l.tokenUser=l.service.getUserId(),l.tokenOP=localStorage.getItem("token"),l.socket.emit("create",l.tokenUser),l.service.getChat(l.tokenUser).subscribe(function(n){l.messages=n,l.scrollBottom()})}),this.socket.fromEvent("received").subscribe(function(n){l.messages.push(n),l.scrollBottom()})},l.prototype.sendMessage=function(){var l={message:this.message,sender:Number(this.service.getUserId()),receiver:1,type:"text",user_sender:this.username,user_receiver:"Admin",chat_id:this.tokenUser,operativo:this.tokenOP,createdAt:new Date};console.log(l),this.socket.emit("send-message",l),this.messages.push(l),this.message="",this.scrollBottom()},l.prototype.sendImageMessage=function(l){var n=this;new o(l.files[0],1024,null).getImage().then(function(l){var e=new FileReader;e.onloadend=function(l){var t={message:e.result,sender:Number(n.service.getUserId()),receiver:1,type:"image",user_sender:n.username,user_receiver:"Admin",chat_id:n.tokenUser,operativo:n.tokenOP,createdAt:new Date};n.socket.emit("send-message",t),n.messages.push(t),n.scrollBottom()},e.readAsDataURL(l)})},l.prototype.ionViewWillLeave=function(){this.socket.disconnect()},l.prototype.scrollBottom=function(){var l=this;try{setTimeout(function(n){l.chatview.el.scrollToBottom(0)})}catch(n){console.log(n)}},l}(),s=function(){return function(){}}(),a=e("pMnS"),r=e("oBZk"),c=e("ZZ/e"),b=function(){function l(){this.close=new t.m}return l.prototype.closeView=function(){this.close.emit(!0)},l.prototype.ngOnInit=function(){},l}(),g=t.rb({encapsulation:0,styles:[[".modal-image[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;left:0;top:0;z-index:999;background:#272727}.modal-image[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{color:#fff;font-size:4rem;position:absolute;right:20px;z-index:2}.modal-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;position:absolute;right:50%;bottom:50%;-webkit-transform:translate(50%,50%);transform:translate(50%,50%);width:100%;-o-object-fit:contain;object-fit:contain}"]],data:{}});function m(l){return t.Pb(0,[(l()(),t.tb(0,0,null,null,4,"div",[["class","modal-image"]],null,null,null,null,null)),(l()(),t.tb(1,0,null,null,2,"a",[["class","close"]],null,[[null,"click"]],function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.closeView()&&t),t},null,null)),(l()(),t.tb(2,0,null,null,1,"ion-icon",[["name","md-close"]],null,null,null,r.L,r.k)),t.sb(3,49152,null,0,c.B,[t.h,t.k,t.z],{name:[0,"name"]},null),(l()(),t.tb(4,0,null,null,0,"img",[["alt",""]],[[8,"src",4]],null,null,null,null))],function(l,n){l(n,3,0,"md-close")},function(l,n){l(n,4,0,n.component.image)})}var h=e("Ip0R"),d=e("ZYCi"),p=e("gIcY"),f=e("92vz"),k=t.rb({encapsulation:0,styles:[[".message[_ngcontent-%COMP%]{padding:10px;border-radius:10px;margin-bottom:4px;white-space:pre-wrap}.my-message[_ngcontent-%COMP%]{background:#3880ff;color:#fff}.other-message[_ngcontent-%COMP%]{background:#e3e3e3;color:#333}.time[_ngcontent-%COMP%]{color:#dfdfdf;float:right;font-size:small}.username[_ngcontent-%COMP%]{display:block;text-align:left!important;font-weight:700;font-style:italic;color:#fff;font-size:.9rem;margin-bottom:.5rem}.other-message[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%], .other-message[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{color:#333}.message-input[_ngcontent-%COMP%]{margin-top:0;background:#fff;min-height:40px}.msg-btn[_ngcontent-%COMP%]{--padding-start:0.5em;--padding-end:0.5em}.icon-svg[_ngcontent-%COMP%]{width:30px;height:30px}"]],data:{}});function v(l){return t.Pb(0,[(l()(),t.tb(0,0,null,null,1,"app-modal-image",[],null,[[null,"close"]],function(l,n,e){var t=!0,u=l.component;return"close"===n&&(u.modalImage=!1,t=!1!==(u.imageSelected=null)&&t),t},m,g)),t.sb(1,114688,null,0,b,[],{image:[0,"image"]},{close:"close"})],function(l,n){l(n,1,0,n.component.imageSelected)},null)}function z(l){return t.Pb(0,[(l()(),t.tb(0,0,null,null,1,"span",[],null,null,null,null,null)),(l()(),t.Nb(1,null,["",""]))],null,function(l,n){l(n,1,0,n.parent.context.$implicit.message)})}function w(l){return t.Pb(0,[(l()(),t.tb(0,0,null,null,0,"img",[],[[8,"src",4]],[[null,"click"]],function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.showImage(l.parent.context.$implicit.message)&&t),t},null,null))],null,function(l,n){l(n,0,0,n.parent.context.$implicit.message)})}function C(l){return t.Pb(0,[(l()(),t.tb(0,0,null,null,16,"ion-row",[],null,null,null,r.Q,r.p)),t.sb(1,49152,null,0,c.hb,[t.h,t.k,t.z],null,null),(l()(),t.tb(2,0,null,0,14,"ion-col",[["class","message"],["size","9"]],[[1,"offset",0]],null,null,r.G,r.f)),t.Kb(512,null,h.u,h.v,[t.s,t.t,t.k,t.D]),t.sb(4,278528,null,0,h.i,[h.u],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),t.sb(5,49152,null,0,c.s,[t.h,t.k,t.z],{size:[0,"size"]},null),(l()(),t.tb(6,0,null,0,1,"div",[["class","username"],["text-right",""]],null,null,null,null,null)),(l()(),t.Nb(7,null,["",""])),(l()(),t.tb(8,0,null,0,5,"div",[],null,null,null,null,null)),t.sb(9,16384,null,0,h.o,[],{ngSwitch:[0,"ngSwitch"]},null),(l()(),t.ib(16777216,null,null,1,null,z)),t.sb(11,278528,null,0,h.p,[t.O,t.L,h.o],{ngSwitchCase:[0,"ngSwitchCase"]},null),(l()(),t.ib(16777216,null,null,1,null,w)),t.sb(13,278528,null,0,h.p,[t.O,t.L,h.o],{ngSwitchCase:[0,"ngSwitchCase"]},null),(l()(),t.tb(14,0,null,0,2,"div",[["class","time"],["text-right",""]],null,null,null,null,null)),(l()(),t.Nb(15,null,["",""])),t.Jb(16,2)],function(l,n){l(n,4,0,"message",n.context.$implicit.sender!=n.component.tokenUser?"my-message":"other-message"),l(n,5,0,"9"),l(n,9,0,n.context.$implicit.type),l(n,11,0,"text"),l(n,13,0,"image")},function(l,n){l(n,2,0,n.context.$implicit.sender==n.component.tokenUser?"":3),l(n,7,0,n.context.$implicit.user_name);var e=t.Ob(n,15,0,l(n,16,0,t.Fb(n.parent,0),n.context.$implicit.createdAt,"short"));l(n,15,0,e)})}function y(l){return t.Pb(0,[t.Hb(0,h.d,[t.u]),t.Lb(671088640,1,{chatview:0}),(l()(),t.ib(16777216,null,null,1,null,v)),t.sb(3,16384,null,0,h.k,[t.O,t.L],{ngIf:[0,"ngIf"]},null),(l()(),t.tb(4,0,null,null,23,"ion-header",[],null,null,null,r.K,r.j)),t.sb(5,49152,null,0,c.A,[t.h,t.k,t.z],null,null),(l()(),t.tb(6,0,null,0,21,"ion-toolbar",[["color","primary"]],null,null,null,r.bb,r.A)),t.sb(7,49152,null,0,c.Ab,[t.h,t.k,t.z],{color:[0,"color"]},null),(l()(),t.tb(8,0,null,0,19,"ion-grid",[],null,null,null,r.J,r.i)),t.sb(9,49152,null,0,c.z,[t.h,t.k,t.z],null,null),(l()(),t.tb(10,0,null,0,17,"ion-row",[["align-items-center",""]],null,null,null,r.Q,r.p)),t.sb(11,49152,null,0,c.hb,[t.h,t.k,t.z],null,null),(l()(),t.tb(12,0,null,0,8,"ion-col",[["size","2"]],null,null,null,r.G,r.f)),t.sb(13,49152,null,0,c.s,[t.h,t.k,t.z],{size:[0,"size"]},null),(l()(),t.tb(14,0,null,0,6,"ion-buttons",[["routerLink","/brands"]],null,[[null,"click"]],function(l,n,e){var u=!0;return"click"===n&&(u=!1!==t.Fb(l,16).onClick()&&u),"click"===n&&(u=!1!==t.Fb(l,17).onClick(e)&&u),u},r.E,r.d)),t.sb(15,49152,null,0,c.k,[t.h,t.k,t.z],null,null),t.sb(16,16384,null,0,d.n,[d.m,d.a,[8,null],t.D,t.k],{routerLink:[0,"routerLink"]},null),t.sb(17,737280,null,0,c.Ib,[h.h,c.Fb,t.k,d.m,[2,d.n]],null,null),(l()(),t.tb(18,0,null,0,2,"ion-button",[],null,null,null,r.D,r.c)),t.sb(19,49152,null,0,c.j,[t.h,t.k,t.z],null,null),(l()(),t.tb(20,0,null,0,0,"img",[["class","icon-svg"],["src","./assets/images/back.svg"]],null,null,null,null,null)),(l()(),t.tb(21,0,null,0,4,"ion-col",[["size","8"]],null,null,null,r.G,r.f)),t.sb(22,49152,null,0,c.s,[t.h,t.k,t.z],{size:[0,"size"]},null),(l()(),t.tb(23,0,null,0,2,"ion-title",[],null,null,null,r.ab,r.z)),t.sb(24,49152,null,0,c.yb,[t.h,t.k,t.z],null,null),(l()(),t.Nb(-1,0,["CHAT"])),(l()(),t.tb(26,0,null,0,1,"ion-col",[["size","2"]],null,null,null,r.G,r.f)),t.sb(27,49152,null,0,c.s,[t.h,t.k,t.z],{size:[0,"size"]},null),(l()(),t.tb(28,0,null,null,5,"ion-content",[],null,null,null,r.H,r.g)),t.sb(29,49152,[[1,4],["chatview",4]],0,c.t,[t.h,t.k,t.z],null,null),(l()(),t.tb(30,0,null,0,3,"ion-grid",[],null,null,null,r.J,r.i)),t.sb(31,49152,null,0,c.z,[t.h,t.k,t.z],null,null),(l()(),t.ib(16777216,null,0,1,null,C)),t.sb(33,278528,null,0,h.j,[t.O,t.L,t.s],{ngForOf:[0,"ngForOf"]},null),(l()(),t.tb(34,0,null,null,27,"ion-footer",[],null,null,null,r.I,r.h)),t.sb(35,49152,null,0,c.y,[t.h,t.k,t.z],null,null),(l()(),t.tb(36,0,null,0,25,"ion-toolbar",[["color","light"]],null,null,null,r.bb,r.A)),t.sb(37,49152,null,0,c.Ab,[t.h,t.k,t.z],{color:[0,"color"]},null),(l()(),t.tb(38,0,null,0,23,"ion-row",[["align-items-center",""]],null,null,null,r.Q,r.p)),t.sb(39,49152,null,0,c.hb,[t.h,t.k,t.z],null,null),(l()(),t.tb(40,0,null,0,8,"ion-col",[["size","8"]],null,null,null,r.G,r.f)),t.sb(41,49152,null,0,c.s,[t.h,t.k,t.z],{size:[0,"size"]},null),(l()(),t.tb(42,0,null,0,6,"ion-textarea",[["auto-grow",""],["class","message-input"],["rows","1"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionBlur"],[null,"ionChange"]],function(l,n,e){var u=!0,o=l.component;return"ionBlur"===n&&(u=!1!==t.Fb(l,43)._handleBlurEvent()&&u),"ionChange"===n&&(u=!1!==t.Fb(l,43)._handleInputEvent(e.target.value)&&u),"ngModelChange"===n&&(u=!1!==(o.message=e)&&u),u},r.Y,r.x)),t.sb(43,16384,null,0,c.Kb,[t.k],null,null),t.Kb(1024,null,p.b,function(l){return[l]},[c.Kb]),t.sb(45,671744,null,0,p.e,[[8,null],[8,null],[8,null],[6,p.b]],{model:[0,"model"]},{update:"ngModelChange"}),t.Kb(2048,null,p.c,null,[p.e]),t.sb(47,16384,null,0,p.d,[[4,p.c]],null,null),t.sb(48,49152,null,0,c.wb,[t.h,t.k,t.z],{rows:[0,"rows"]},null),(l()(),t.tb(49,0,null,0,6,"ion-col",[["size","2"]],null,null,null,r.G,r.f)),t.sb(50,49152,null,0,c.s,[t.h,t.k,t.z],{size:[0,"size"]},null),(l()(),t.tb(51,0,null,0,4,"ion-button",[["class","msg-btn"],["color","primary"],["expand","block"],["fill","clear"]],null,[[null,"click"]],function(l,n,e){var u=!0;return"click"===n&&(u=!1!==t.Fb(l,55).click()&&u),u},r.D,r.c)),t.sb(52,49152,null,0,c.j,[t.h,t.k,t.z],{color:[0,"color"],expand:[1,"expand"],fill:[2,"fill"]},null),(l()(),t.tb(53,0,null,0,1,"ion-icon",[["name","ios-camera"],["slot","icon-only"]],null,null,null,r.L,r.k)),t.sb(54,49152,null,0,c.B,[t.h,t.k,t.z],{name:[0,"name"]},null),(l()(),t.tb(55,0,[["filechooser",1]],0,0,"input",[["capture","camera"],["hidden",""],["type","file"]],null,[[null,"change"]],function(l,n,e){var u=!0;return"change"===n&&(u=!1!==l.component.sendImageMessage(t.Fb(l,55))&&u),u},null,null)),(l()(),t.tb(56,0,null,0,5,"ion-col",[["size","2"]],null,null,null,r.G,r.f)),t.sb(57,49152,null,0,c.s,[t.h,t.k,t.z],{size:[0,"size"]},null),(l()(),t.tb(58,0,null,0,3,"ion-button",[["class","msg-btn"],["color","primary"],["expand","block"],["fill","clear"]],null,[[null,"click"]],function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.sendMessage()&&t),t},r.D,r.c)),t.sb(59,49152,null,0,c.j,[t.h,t.k,t.z],{color:[0,"color"],disabled:[1,"disabled"],expand:[2,"expand"],fill:[3,"fill"]},null),(l()(),t.tb(60,0,null,0,1,"ion-icon",[["name","ios-send"],["slot","icon-only"]],null,null,null,r.L,r.k)),t.sb(61,49152,null,0,c.B,[t.h,t.k,t.z],{name:[0,"name"]},null)],function(l,n){var e=n.component;l(n,3,0,e.modalImage),l(n,7,0,"primary"),l(n,13,0,"2"),l(n,16,0,"/brands"),l(n,17,0),l(n,22,0,"8"),l(n,27,0,"2"),l(n,33,0,e.messages),l(n,37,0,"light"),l(n,41,0,"8"),l(n,45,0,e.message),l(n,48,0,"1"),l(n,50,0,"2"),l(n,52,0,"primary","block","clear"),l(n,54,0,"ios-camera"),l(n,57,0,"2"),l(n,59,0,"primary",""===e.message,"block","clear"),l(n,61,0,"ios-send")},function(l,n){l(n,42,0,t.Fb(n,47).ngClassUntouched,t.Fb(n,47).ngClassTouched,t.Fb(n,47).ngClassPristine,t.Fb(n,47).ngClassDirty,t.Fb(n,47).ngClassValid,t.Fb(n,47).ngClassInvalid,t.Fb(n,47).ngClassPending)})}function _(l){return t.Pb(0,[(l()(),t.tb(0,0,null,null,1,"app-chat",[],null,null,null,y,k)),t.sb(1,8503296,null,0,i,[f.a,u.a],null,null)],function(l,n){l(n,1,0)},null)}var M=t.pb("app-chat",i,_,{},{},[]);e.d(n,"ChatPageModuleNgFactory",function(){return P});var P=t.qb(s,[],function(l){return t.Cb([t.Db(512,t.j,t.bb,[[8,[a.a,M]],[3,t.j],t.x]),t.Db(4608,h.m,h.l,[t.u,[2,h.z]]),t.Db(4608,p.g,p.g,[]),t.Db(4608,c.b,c.b,[t.z,t.g]),t.Db(4608,c.Eb,c.Eb,[c.b,t.j,t.q]),t.Db(4608,c.Hb,c.Hb,[c.b,t.j,t.q]),t.Db(5120,f.a,f.c,[f.d]),t.Db(1073742336,h.b,h.b,[]),t.Db(1073742336,p.f,p.f,[]),t.Db(1073742336,p.a,p.a,[]),t.Db(1073742336,c.Cb,c.Cb,[]),t.Db(1073742336,d.o,d.o,[[2,d.t],[2,d.m]]),t.Db(1073742336,f.b,f.b,[]),t.Db(1073742336,s,s,[]),t.Db(1024,d.k,function(){return[[{path:"",component:i}]]},[]),t.Db(256,f.d,{url:"http://190.60.205.188:500",options:{}},[])])})}}]);